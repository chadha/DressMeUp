jQuery.fn.positionAncestor=function(selector){var left=0;var top=0;this.each(function(index,element){var $ancestor=$(this).closest(selector);if($ancestor.length&&$ancestor.css("position")!=="static"){var $child=$(this);var childMarginEdgeLeft=$child.offset().left-parseInt($child.css("marginLeft"),10);var childMarginEdgeTop=$child.offset().top-parseInt($child.css("marginTop"),10);var ancestorPaddingEdgeLeft=$ancestor.offset().left+parseInt($ancestor.css("borderLeftWidth"),10);var ancestorPaddingEdgeTop=
$ancestor.offset().top+parseInt($ancestor.css("borderTopWidth"),10);left=childMarginEdgeLeft-ancestorPaddingEdgeLeft;top=childMarginEdgeTop-ancestorPaddingEdgeTop;return false}});return{left:left,top:top}};var _ArcQ=_ArcQ||[],Arcadia=Arcadia||{};Arcadia.Product.printPage=function(){$("#link_print").click(function(){window.print();return false})};
Arcadia.Product.initTabs=function(){var menu=$("#product_tab_menu").get(0),tabs=$(".tab",menu);$("#product_tab_menu li").fadeIn("slow");$("a",menu).click(function(){var nextTab=$($(this).attr("href"));$(".tab").hide();$("#product_tab_menu li").removeClass("active_item");$(this).parent().addClass("active_item");nextTab.show();return false})};
Arcadia.Product.initZoom=function(){function triggerLightbox(){$("#product_viewer_instructions a").click();return false}var wrapper=$("#wrapper_page_content").get(0),config=$.extend({target:"#product_view_full",overlay:$(".product_column_2",wrapper),wrapper:$(".wrapper_product_view",wrapper),xOffset:{square:29,rectangular:60},yOffset:-1,maxImgHeight:Arcadia.Brand.productSettings.maxImgHeight,isAjax:false,clickHandler:triggerLightbox},Arcadia.Brand.productSettings.zoom),zoom=new Arcadia.Product.Zoom(config);
$(".wrapper_product_view",wrapper).append('<p id="product_viewer_instructions"><span>'+Arcadia.Localisation.getMessage("product_or_bundle.mes_0")+"</span></p>")};Arcadia.Product.sizeGuideUrlIncludesHash=false;
Arcadia.Product.initProductSizeGrid=function(){var grid=new Arcadia.Product.SizeGrid({form:"#form_product_full",stockThreshold:productData.stockThreshold});var addToBag=new Arcadia.Product.AddToBag({target:"#form_product_full",sizeGrid:grid,data:productData});if(!Arcadia.Brand.productSettings.sizeGuide.enabled)var sizeLink=$(".product_size_guide").addClass("lightbox").insertAfter(".selected_size");else{var attributes=productData.productAttributes||{};var sizeLink=$('<a href="#" class="product_size_guide" title="Size guide">'+
Arcadia.Localisation.getMessage("information.mes_54")+"</a>"),sizeGuide=typeof attributes["ECMC_PROD_SIZE_GUIDE_"+Arcadia.Brand.ecmcId]==="undefined"?"":attributes["ECMC_PROD_SIZE_GUIDE_"+Arcadia.Brand.ecmcId],sizeGuideEnabled=sizeGuide.toLowerCase()==="nosizeguide"||Arcadia.Brand.productSettings.sizeGuide.configUrl===""?false:true,productCategoryExists=typeof attributes["ECMC_PROD_PRODUCT_TYPE_"+Arcadia.Brand.ecmcId]!=="undefined"?true:false,productCategory=productCategoryExists?attributes["ECMC_PROD_PRODUCT_TYPE_"+
Arcadia.Brand.ecmcId].toUpperCase():"",showDropdown=typeof Arcadia.Brand.productSettings.dropdownCategories[productCategory]!=="undefined"?true:false,onError=function(jqXHR,textStatus,errorThrown){Arcadia.Utility.log(textStatus)},onSuccess=function(data){var map=data.documentElement,sizeCount=typeof productData.items!=="undefined"?productData.items.length:0,sizeGuideTarget=$("#product_size_full"),href=Arcadia.Brand.productSettings.sizeGuide.defaultUrl;if(sizeCount<=Arcadia.Brand.productSettings.maxGridSize&&
sizeCount!==1&&!showDropdown)sizeGuideTarget=$(".selected_size");else if(sizeCount===1&&!showDropdown)sizeGuideTarget=$("#product_quantity_full");if(typeof sizeGuide!=="undefined")for(var i=0;i<map.childNodes.length;i++)if(map.childNodes[i].nodeName!=="#text")if(sizeGuide.toUpperCase()===$.trim(map.childNodes[i].getAttribute("type").toUpperCase()))href=map.childNodes[i].getAttribute("ref");Arcadia.Product.sizeGuideUrlIncludesHash=href.indexOf("#")!==-1?true:false;if(href!==""){new Arcadia.UI.LightBox({target:sizeLink,
href:href.split("#")[0],innerWidth:Arcadia.Brand.productSettings.sizeGuide.width,initialWidth:Arcadia.Brand.productSettings.sizeGuide.width,height:Arcadia.Brand.productSettings.sizeGuide.height,onComplete:function(){var hash=href.split("#")[1];if(hash)$("a","#cboxContent").each(function(){var thisHref=typeof $(this).attr("href")==="undefined"?"":$(this).attr("href");if(thisHref.indexOf(hash)!==-1)$(this).trigger("click")})}});sizeLink.insertAfter(sizeGuideTarget)}};if(sizeGuideEnabled)$.ajax({url:Arcadia.Brand.productSettings.sizeGuide.configUrl,
method:"GET",dataType:"xml",success:onSuccess,error:onError})}Arcadia.Product.initTempFixStyle369()};
if(Arcadia.Brand.productSettings.ratingsAndreviewsWearWiths.activated===true)Arcadia.Product.initDescriptions=function(){$(".associated_product").each(function(){var effect=new Arcadia.Product.FadeToggle({target:this,animatedElement:".product_description, .ratingsreviews",ratingAndReviewsElement:".ratingsreviews",overlayPadding:Arcadia.Brand.productSettings.ratingsAndreviewsWearWiths.overlayPadding,ratingAndReviewsPosition:Arcadia.Brand.productSettings.ratingsAndreviewsWearWiths.position})})};else Arcadia.Product.initDescriptions=
function(){$(".associated_product").each(function(){var effect=new Arcadia.Product.FadeToggle({target:this,animatedElement:".product_description"})})};
Arcadia.Product.initLightbox=function(){if(productData.images>0){var slideshow=new Arcadia.UI.LightBox({target:$('<a href="'+Arcadia.Loader.rootPath+'/lib/html/product-slideshow.html">'+Arcadia.Localisation.getMessage("product_or_bundle.mes_1")+"</a>"),href:Arcadia.Loader.rootPath+"/lib/html/product-slideshow.html",transition:"fade",innerWidth:850,initialWidth:850,height:"100%",scalePhotos:false,scrolling:false,onComplete:function(){var target=$("#product_view_full img").attr("src");$("#colorbox").addClass("slideshow_lightbox");
Arcadia.Product.initSlideshow(target)}});if(Arcadia.Product.slideshowReady===false){$("#product_viewer_instructions").append(slideshow.target);Arcadia.Product.slideshowReady=true}}var associatedViews=function(){var associations=[];$(".associated_product a").each(function(){associations.push(new Arcadia.Product.Lightbox({target:this}))});return associations}()};
Arcadia.Product.initSlideshow=function(initialImage){function isTouchDevice(){return typeof window.ontouchstart!="undefined"?true:false}var eventHandle;if(isTouchDevice())eventHandler="touchstart";else eventHandler="click";var wrapper=$("#wrapper_product_slideshow").get(0),initialIndex=1,o=this;this.initialImage=initialImage.replace("normal","large");if(productData.images===0){Arcadia.Utility.log("Product has no views, Arcadia.Product.initSlideshow quitting");return}function linkBuilder(counter,data){var href=
Arcadia.Product.imagePath(data.code,counter,"large",productData.counterStrings[counter-1]),src=Arcadia.Product.imagePath(data.code,counter,"small",productData.counterStrings[counter-1]);if(Arcadia.Utility.getFileName(href)===Arcadia.Utility.getFileName(o.initialImage))o.initialIndex=counter-1;function trackEvent(){}return $('<a href="'+href+'" class="vc" title="'+Arcadia.Localisation.getMessage("information.mes_5",[counter])+'"><img src="'+src+'" alt="'+Arcadia.Localisation.getMessage("product_or_bundle.mes_2",
[counter,data.name])+'"><span>&nbsp;</span></a>').click(trackEvent)}var slides=function(){var imgs="";for(var i=1;i<=productData.images;i=i+1)imgs+="<img src = "+Arcadia.Product.imagePath(productData.code,i,"large",productData.counterStrings[i-1])+" />";return $(imgs)}().appendTo($(".wrapper_product_view",wrapper));if(productData.images>1){var carousel=new Arcadia.Product.Scroller({data:productData,wrapper:$(".product_thumb_carousel",wrapper),movement:{top:89,left:0},itemsInView:4,text:{prev:Arcadia.Localisation.getMessage("product_or_bundle.mes_3"),
next:Arcadia.Localisation.getMessage("product_or_bundle.mes_4")},linkBuilder:linkBuilder});var cycle=new Arcadia.UI.Cycle({target:$(".wrapper_product_view",wrapper),prev:$(".slideshow_prev",wrapper).fadeIn(),next:$(".slideshow_next",wrapper).fadeIn(),startingSlide:o.initialIndex,prevNextEvent:eventHandler,pagerEvent:eventHandler,pager:carousel.menu,pause:true,timeout:0,pagerAnchorBuilder:function(index,DOMElement){return this.pager.children("li").get(index)}})}var box=$("#cboxLoadedContent"),boxHeight=
box.height(),imgWrapper=$(".wrapper_product_view",wrapper),wrapperHeight=imgWrapper.height(),offset=box.positionAncestor("#colorbox");box.mousemove(function(e){var imgHeight=$("#wrapper_product_slideshow .wrapper_product_view img").eq(0).height();if(imgHeight<boxHeight)return;var off=(e.clientY/boxHeight).toFixed(2),top=parseInt(off*(boxHeight-imgHeight+offset.top));imgWrapper.css({top:top+"px"})})};
Arcadia.Product.initHistory=function(){function getCookieData(){var array=[];var cookie=Arcadia.Utility.getCookie(cookieName);if(cookie!==null&&cookie!==""){array=cookie.split("|");if(array[0]==="")array.shift()}return array}function arrayToObject(data){var properties={};for(var i=0;i<data.length;i=i+1){var item=data[i].split("=");properties[item[0]]=item[1]}function stripNull(value){var string=value;if(value==="null")string="";return string}var qs=["beginIndex=0","viewAllFlag=","langId="+Arcadia.Brand.langId,
"storeId="+stripNull(properties.s),"catalogId="+stripNull(properties.ct),"parent_categoryId="+stripNull(properties.pa),"categoryId="+stripNull(properties.c),"productId="+stripNull(properties.p)];return{href:"/webapp/wcs/stores/servlet/ProductDisplay?"+qs.join("&"),src:Arcadia.Product.imagePath(properties.co,1,"small","_"),description:stripNull(decodeURIComponent(properties.d)),productId:stripNull(properties.p)}}function filterCookieData(productId,cookieData){var newData=[];for(var i=0;i<cookieData.length;i=
i+1)if(parseInt(arrayToObject(cookieData[i].split("^")).productId)!==parseInt(productId))newData.push(cookieData[i]);return newData}function updateCookie(array){if(array.length>10)array=array.slice(array.length-10,array.length);if(array.length>0)Arcadia.Utility.setCookie(cookieName,array.join("|"),14);else Arcadia.Utility.setCookie(cookieName,"",-1)}function deleteHistoryItem(item){var el=$(item);el.parent().parent().fadeOut(function(){el.remove();updateHistoryPanel()})}function updateHistoryPanel(){var data=
filterCookieData(productData.id,getCookieData()),wrapper=$("#product_recently_viewed");if(data.length===0)wrapper.slideUp();else wrapper.slideDown();carousel.updateImageCount(data.length);carousel.resetNav()}function itemClickHandler(){var productId=Arcadia.Utility.getUrlParam("productid",$(this).siblings().attr("href")),newData=filterCookieData(productId,getCookieData());updateCookie(newData);deleteHistoryItem(this);return false}function dataToArray(productData){Arcadia.Page=Arcadia.Page||{};var o=
["p="+productData.id,"c="+(Arcadia.Page.categoryId||""),"pa="+(Arcadia.Page.parent_categoryId||""),"s="+(Arcadia.Page.storeId||""),"ct="+(Arcadia.Page.catalogId||""),"co="+productData.code,"d="+encodeURIComponent(productData.name)].join("^");return o}function linkBuilder(counter,description){var itemData=filterCookieData(productData.id,cookieData).reverse();productObject=arrayToObject(itemData[counter-1].split("^"));var r=$('<span class="history_item" />'),link=$('<a href="'+productObject.href+'" class="vc"><img src="'+
productObject.src+'" alt="'+productObject.description+'" title="'+Arcadia.Localisation.getMessage("product_or_bundle.mes_5",[productObject.description])+'"><span>&nbsp;</span></a>').appendTo(r),deleteLink=$('<a href="#" title="'+Arcadia.Localisation.getMessage("product_or_bundle.mes_6")+'" class="remove replace">'+Arcadia.Localisation.getMessage("product_or_bundle.mes_7")+"</a>").click(itemClickHandler).prependTo(r);return r}var cookieName="arc-"+Arcadia.Brand.activeSalesCatalogId+"-recently_viewed",
cookieData=getCookieData(),validImageLength=filterCookieData(productData.id,cookieData).length;(function removeExistingItem(){var item;for(var i=0;i<cookieData.length;i++){item=arrayToObject(cookieData[i].split("^"));if(parseInt(item.productId)===parseInt(productData.id)){cookieData.splice(i,1);break}}})();cookieData.push(dataToArray(productData));updateCookie(cookieData);if(validImageLength===0)return;var config=$.extend({data:{images:validImageLength},wrapper:$("#product_recently_viewed_carousel"),
movement:{top:0,left:64},itemsInView:5,text:{prev:Arcadia.Localisation.getMessage("product_or_bundle.mes_8"),next:Arcadia.Localisation.getMessage("product_or_bundle.mes_9")},linkBuilder:linkBuilder},Arcadia.Brand.productSettings.historyScroller);var carousel=new Arcadia.Product.Scroller(config);updateHistoryPanel()};Arcadia.Product.initViews=function(){var carousel=new Arcadia.Product.Carousel({data:productData,wrapper:$("#wrapper_page_content .product_column_1")})};
Arcadia.Product.initFlashLink=function(){var flashLink=Arcadia.Product.openCarousel("#wrapper_page_content")};
Arcadia.Product.initTempFixStyle369=function(){if(Arcadia.Brand.storeId===13054){$('#form_product_full li a[title*="Size 28"]').remove();$('#form_product_full li a[title*="Size 28L"]').remove();$('#form_product_full li a[title*="Size 28R"]').remove();$('#form_product_full li a[title*="Size 28S"]').remove();$('#form_product_full li a[title*="Size 28l"]').remove();$('#form_product_full li a[title*="Size 28r"]').remove();$('#form_product_full li a[title*="Size 28s"]').remove();$('#form_product_full li a[title*="30"]').remove();
$('#form_product_full li a[title*="32"]').remove();$('#form_product_full li a[title*="34"]').remove();$('#form_product_full li a[title*="36"]').remove();$('#form_product_full li span[title*="Size 28"]').remove();$('#form_product_full li span[title*="Size 28L"]').remove();$('#form_product_full li span[title*="Size 28R"]').remove();$('#form_product_full li span[title*="Size 28S"]').remove();$('#form_product_full li span[title*="Size 28l"]').remove();$('#form_product_full li span[title*="Size 28r"]').remove();
$('#form_product_full li span[title*="Size 28s"]').remove();$('#form_product_full li span[title*="30"]').remove();$('#form_product_full li span[title*="32"]').remove();$('#form_product_full li span[title*="34"]').remove();$('#form_product_full li span[title*="36"]').remove();$('#form_product_full .product_size option[value="28"]').remove();$('#form_product_full .product_size option[value="28l"]').remove();$('#form_product_full .product_size option[value="28r"]').remove();$('#form_product_full .product_size option[value="28s"]').remove();
$('#form_product_full .product_size option[value="28L"]').remove();$('#form_product_full .product_size option[value="28R"]').remove();$('#form_product_full .product_size option[value="28S"]').remove();$('#form_product_full .product_size option[value*="30"]').remove();$('#form_product_full .product_size option[value*="32"]').remove();$('#form_product_full .product_size option[value*="34"]').remove();$('#form_product_full .product_size option[value*="36"]').remove()}};
$("#nav_category_home").click(function(e){e.preventDefault();history.back()});
Arcadia.Product.initStockChecker=function(){var _reset_url=document.location.href;if(Arcadia.Brand.isUSStore===true)return;if(Arcadia.Brand.stockCheckerEnabled===false)return;var stockCheckAvailable=true;var productLineId=productData.code.toString();for(var i=0;i<Arcadia.Brand.stockCheckerSettings.excludedLines.length;i++){var productLine="^"+Arcadia.Brand.stockCheckerSettings.excludedLines[i]+"[0-9A-Za-z]{1,2}";if(productLineId.match(productLine))stockCheckAvailable=false}if(Arcadia.Brand.stockCheckerEnabled===
true)if(stockCheckAvailable===false)$('<h3 id="check_stock_header_disabled">'+Arcadia.Localisation.getMessage("product_or_bundle.mes_10")+'</h3><p class="form_navigation cf menu_inline" id="check_stores_menu"><img src="'+Arcadia.Utility.assetRoot+"/wcsstore/ConsumerDirectStorefrontAssetStore/images/colors/color"+Arcadia.Brand.styleColour+'/v3/btn_stock_checker_unavailable.gif" alt="'+Arcadia.Brand.stockCheckerSettings.btnAltTextUnavailable+'" /></p>').hide().insertAfter("#form_product_full").fadeIn();
else $('<h3 id="check_stock_header">'+Arcadia.Localisation.getMessage("product_or_bundle.mes_10")+'</h3><p class="form_navigation cf menu_inline replace" id="check_stores_menu"><a href="#" title="'+Arcadia.Brand.stockCheckerSettings.btnAltTextAvailable+'" id="link_check_stores">"'+Arcadia.Brand.stockCheckerSettings.btnAltTextAvailable+'"</a></p>').hide().insertAfter("#form_product_full").fadeIn();var storeFinder=new Arcadia.Forms.StoreFinder({target:"#link_check_stores",productData:productData}),
sizeMenu=$("#product_size_full");$("#link_check_stores").click(function(){storeFinder.sfObject.productData.selectedSizeOption=sizeMenu.val()})};
Arcadia.Product.initEmailBackInStock=function(){if($("#email_me_back_in_stock").length>0)new Arcadia.UI.LightBox({target:$("#email_me_back_in_stock"),href:Arcadia.Loader.rootPath+"/lib/html/email-back-in-stock-"+Arcadia.Brand.locale+".html",transition:"fade",innerWidth:525,initialWidth:525,scalePhotos:false,scrolling:false,onComplete:function(){$("#wrapper_email_in_stock .error").hide();function submitHandler(){toggleForm(true);$.ajax({url:getUrl(),dataType:"json",success:onSuccess,error:onError});
function onSuccess(data){toggleForm(false);if(data.success){$('.error, #info, #out_of_stock_sizes, form[name="email_back_in_stock"], h3',"#wrapper_email_in_stock").hide();$('form[name="email_back_in_stock"]').after('<p class="message">'+data.message+"</p>")}else onError(data)}function onError(data){toggleForm(false);$("#server_error").html(data.message).show()}function toggleForm(disable){var input='form[name="email_back_in_stock"] > fieldset > p > input',error=$("#server_error"),progress=$(".ajax_progress_indicator");
if(disable){$(input).attr("disabled","disabled");progress.show();error.hide()}else{$(input).removeAttr("disabled");progress.hide()}}function getUrl(){var partnumber="",temp=$("a.active","#out_of_stock_sizes").attr("title").split(" "),url="EmailWhenInStockCmd?Email_address="+$("#email",'form[name="email_back_in_stock"]').val();temp.shift();var size=temp.join(" ");$.map(productData.items,function(value,key){if(value.size.toLowerCase()===size.toLowerCase())partnumber=value.sku});url+="&catentry_id="+
productData.id;url+="&size="+size;url+="&partnumber="+partnumber;url+="&foreName="+$("#first_name").val();url+="&surName="+$("#last_name").val();url+="&storeId="+Arcadia.Brand.storeId;return url}return false}this.validationSettings={target:$('form[name="email_back_in_stock"]'),rules:{first_name:{required:true},last_name:{required:true},email:{required:true,email:true}},submitHandler:submitHandler};(new Arcadia.Forms.Validation(this.validationSettings)).validator;var grid=new Arcadia.Product.SizeGrid({form:"#form_product_full",
stockThreshold:productData.stockThreshold,emailMeBackInStock:true});$("#out_of_stock_sizes").html(grid);$("a:not('.stock_zero'):visible:first",grid).click();$("#product_name").html(productData.name);$("#email_in_stock_submit").click(function(e){e.preventDefault();$('form[name="email_back_in_stock"]').submit()});var maximumHeight=$(window).height();var initialLightboxHeight=$("#colorbox").height();var columnHeight=$("#wrapper_email_in_stock").outerHeight();var topSection=$("#cboxTopCenter").outerHeight();
var bottomSection=$("#cboxBottomCenter").outerHeight();var contentHeight=columnHeight+topSection+bottomSection;if(contentHeight>initialLightboxHeight&&contentHeight<maximumHeight)$.colorbox.resize({height:contentHeight});else if(contentHeight>initialLightboxHeight&&contentHeight>maximumHeight)$.colorbox.resize({height:maximumHeight})}})};
Arcadia.Product.initMiniSizeGuide=function(){if($(".size_guide_toggle_link").size()){$(".size_guide_toggle_link").unbind();$(".size_guide_toggle_link").click(function(e){s.trackExternalLinks=false;s.linkTrackVars="products,events";s.linkTrackEvents="event45";s.events="event45";s.tl(this,"o","sizeguidetoggle");$(".size_guide_toggle_content").slideToggle(600);return false})}};
_ArcQ.push([Arcadia.Product.initProductSizeGrid],[Arcadia.Product.initViews],[Arcadia.Product.initDescriptions],[Arcadia.Product.initTabs],[Arcadia.Product.initHistory],[Arcadia.Product.printPage],[Arcadia.Product.initZoom],[Arcadia.Product.initLightbox],[Arcadia.Product.initFlashLink],[Arcadia.Product.initStockChecker],[Arcadia.Product.initEmailBackInStock],[Arcadia.Product.initMiniSizeGuide]);
if(Arcadia.Brand.peeriusSettings.enabled)$(document).ready(function(){var script=document.createElement("script");script.type="text/javascript";script.charset="UTF-8";script.src="//"+Arcadia.Brand.peeriusSettings.subdomain+".peerius.com/tracker/peerius.page";document.body.appendChild(script)});
